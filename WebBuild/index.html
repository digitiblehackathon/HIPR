<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>HIPR</title>
    <script src="Build/UnityLoader.js"></script>
    <script>
    	window.addEventListener('load', async () => {
    	    // Modern dapp browsers...
    	    if (window.ethereum) {
    	        window.web3 = new Web3(ethereum);
    	        try {
    	            // Request account access if needed
    	            await ethereum.enable();
    	            // Acccounts now exposed
    	            OnCheckingDone();
    	        } 
    	        catch (error) {
    	            OnError("User denied access to Metamask for this app");
    	        }
    	    }
    	    // Legacy dapp browsers...
    	    else if (window.web3) {
    	        window.web3 = new Web3(web3.currentProvider);
    	        // Acccounts always exposed
	            OnCheckingDone();
    	    }
    	    // Non-dapp browsers...
    	    else {
    	        OnError('Non-Ethereum browser detected. You should consider trying MetaMask!');
    	    }
    	});

    	function OnCheckingDone()
    	{
    		if(typeof(window.web3.eth.accounts[0]) == 'undefined')
    		{
    			OnError("Please log into Metamask to play on HIPR.");
    		}
    		else
    		{
				var gameInstance = UnityLoader.instantiate("gameContainer", "Build/WebBuild.json");
    		}
    	}

    	function OnError(message)
    	{
    		document.getElementById("metamaskWarning").innerText = message;
    		document.getElementById("gameContainer").style.display = "none";
    	}


    	/*window.addEventListener('load', function() {
    	        // Checking if Web3 has been injected in the browser (Mist/MetaMask)
    	        if (typeof web3 !== 'undefined') 
    	        {
    	          web3.version.getNetwork(
    	          	(err, netId) => 
    	          	{
    	          		// netId is the ID of the connected network (4 = Rinkeby)
						window.web3 = new Web3(web3.currentProvider);
						if(typeof(window.web3.eth.accounts[0]) == 'undefined')
						{
							document.getElementById("metamaskWarning").innerText = 'Please unlock Metamask to view and submit your top scores';       
						}
						else
						{
							document.getElementById("metamaskWarning").innerText = '';
    						var gameInstance = UnityLoader.instantiate("gameContainer", "Build/WebBuild.json");
						}
    	            });
    	        } 
    	        else 
    	        {
    	        	document.getElementById("metamaskWarning").innerText = 'Please install Metamask to view and submit your top scores';
    	        }
    	    });*/

    </script>
  </head>
  <body style="background: rgb(35, 31, 32);">
    <div id="gameContainer" style="width: 100%; height: 100%; position: absolute; margin: 0px; top: 0px; left: 0px; bottom: 0px; right: 0px; padding: 0px; border: 0px; background: rgb(35, 31, 32);"></div>
	<div class="footer">
		<div class="webgl-logo"></div> 
		<div class="fullscreen" onclick="gameInstance.SetFullscreen(1)"></div>
	</div>
	<div class="footer">
		<h2 id="metamaskWarning" style="color: #e2e2e2; text-align: center; font-family: sans-serif, monospace;"></h2>
	</div>
  </body>
</html>